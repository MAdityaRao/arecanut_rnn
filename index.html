<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArecaNut Price Predictor ¬∑ AI-Powered Forecasting</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Animated gradient background */
        .gradient-bg {
            background: linear-gradient(-45deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Glass morphism cards */
        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
        }

        .glass-card-dark {
            background: rgba(30, 30, 50, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Colorful gradient buttons */
        .btn-gradient-purple {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        .btn-gradient-purple:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-gradient-blue {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            transition: all 0.3s ease;
        }
        .btn-gradient-blue:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(79, 172, 254, 0.4);
        }

        .btn-gradient-pink {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            transition: all 0.3s ease;
        }
        .btn-gradient-pink:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(240, 147, 251, 0.4);
        }

        .btn-gradient-orange {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            transition: all 0.3s ease;
        }
        .btn-gradient-orange:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(250, 112, 154, 0.4);
        }

        /* Animated loading spinner */
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #ffffff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 0.8s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Smooth fade-in animations */
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        
        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(20px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }

        /* Hover effects */
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 40px rgba(31, 38, 135, 0.25);
        }

        /* Colorful badges */
        .badge-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* Price display with glow */
        .price-glow {
            text-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
        }

        /* Pulse animation for status */
        .pulse-dot {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Chart container styling */
        .chart-container {
            position: relative;
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            padding: 1.5rem;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-4 md:p-8">
    <div class="w-full max-w-7xl mx-auto">

        <!-- Premium Header with animated icons -->
        <div class="mb-10 text-center fade-in">
            <div class="inline-block mb-4">
                <div class="text-6xl mb-2 animate-bounce">üå¥</div>
            </div>
            <h1 class="text-4xl md:text-6xl font-bold text-white mb-3 tracking-tight">
                ArecaNut AI Predictor
            </h1>
            <p class="text-white/90 text-lg md:text-xl font-medium mb-2">
                Smart Forecasting ¬∑ Machine Learning Powered
            </p>
            <div class="flex items-center justify-center gap-3 flex-wrap">
                <span class="badge-gradient">ü§ñ RNN Model</span>
                <span class="badge-gradient">üß† LSTM Model</span>
                <span class="badge-gradient">üìä Real-time Data</span>
            </div>
            <div id="currentDate" class="text-white/70 text-sm mt-4 font-mono"></div>
        </div>

        <!-- Colorful Status Bar -->
        <div id="statusBar" class="glass-card border-l-4 border-purple-500 p-4 mb-8 rounded-2xl hidden fade-in shadow-xl" role="alert">
            <div class="flex items-center gap-3">
                <div class="pulse-dot w-3 h-3 rounded-full bg-purple-500"></div>
                <span class="font-semibold text-gray-800">Status:</span>
                <span id="statusMessage" class="text-gray-700">‚Äî</span>
            </div>
        </div>

        <!-- Main Action Cards Grid -->
        <div class="grid md:grid-cols-2 gap-8 mb-10">
            
            <!-- Single Prediction Card - Vibrant Purple Theme -->
            <div class="glass-card rounded-3xl p-8 card-hover fade-in shadow-2xl">
                <div class="flex items-center gap-3 mb-2">
                    <div class="text-3xl">üéØ</div>
                    <h2 class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                        Next-Day Prediction
                    </h2>
                </div>
                <p class="text-gray-600 text-sm mb-6 ml-12">Get tomorrow's forecasted price instantly</p>

                <div class="space-y-4">
                    <button onclick="predictPrice('adike')" 
                            id="predictAdike"
                            class="w-full btn-gradient-purple text-white font-semibold py-4 px-6 rounded-2xl text-base tracking-wide shadow-lg">
                        <span class="text-xl mr-2">ü••</span> Predict Adike Price
                    </button>
                    
                    <button onclick="predictPrice('patora')" 
                            id="predictPatora"
                            class="w-full btn-gradient-pink text-white font-semibold py-4 px-6 rounded-2xl text-base tracking-wide shadow-lg">
                        <span class="text-xl mr-2">üå∞</span> Predict Patora Price
                    </button>
                </div>

                <!-- Prediction Result Display -->
                <div id="predictionResult" class="mt-8 p-6 glass-card rounded-2xl hidden fade-in">
                    <div class="flex items-center gap-2 mb-4">
                        <span class="text-2xl">üìà</span>
                        <h3 class="text-sm font-bold text-gray-700 uppercase tracking-wider">Price Forecast</h3>
                    </div>
                    <div id="predictionContent" class="text-center"></div>
                </div>
            </div>

            <!-- Multi-day Forecast Card - Vibrant Blue Theme -->
            <div class="glass-card rounded-3xl p-8 card-hover fade-in shadow-2xl">
                <div class="flex items-center gap-3 mb-2">
                    <div class="text-3xl">üìä</div>
                    <h2 class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent">
                        7-Day Forecast
                    </h2>
                </div>
                <p class="text-gray-600 text-sm mb-6 ml-12">Visualize weekly price trends & predictions</p>
                
                <div class="space-y-4">
                    <button onclick="generateForecast('adike')" 
                            id="forecastAdike"
                            class="w-full btn-gradient-blue text-white font-semibold py-4 px-6 rounded-2xl text-base tracking-wide shadow-lg">
                        <span class="text-xl mr-2">üìâ</span> Adike 7-Day Outlook
                    </button>
                    
                    <button onclick="generateForecast('patora')" 
                            id="forecastPatora"
                            class="w-full btn-gradient-orange text-white font-semibold py-4 px-6 rounded-2xl text-base tracking-wide shadow-lg">
                        <span class="text-xl mr-2">üìà</span> Patora 7-Day Outlook
                    </button>
                </div>

                <!-- Quick Stats Display -->
                <div class="mt-8 grid grid-cols-2 gap-4">
                    <div class="glass-card p-4 rounded-xl text-center">
                        <div class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent">30</div>
                        <div class="text-xs text-gray-600 mt-1">Days Analyzed</div>
                    </div>
                    <div class="glass-card p-4 rounded-xl text-center">
                        <div class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">7</div>
                        <div class="text-xs text-gray-600 mt-1">Days Forecast</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Premium Chart Section -->
        <div class="glass-card rounded-3xl p-8 fade-in shadow-2xl">
            <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
                <div class="flex items-center gap-3">
                    <span class="text-3xl">üìä</span>
                    <h2 class="text-2xl font-bold text-gray-800" id="chartTitle">Price Visualization</h2>
                </div>
                <div class="flex items-center gap-2">
                    <span class="px-4 py-2 bg-gradient-to-r from-purple-100 to-pink-100 text-purple-700 rounded-full text-sm font-semibold">
                        ‚Çπ per Quintal
                    </span>
                </div>
            </div>
            
            <div class="chart-container relative w-full" style="height: 450px;">
                <canvas id="priceChart"></canvas>
            </div>
            
            <div id="chartMessage" class="text-center py-12">
                <div class="text-6xl mb-4">üìà</div>
                <p class="text-gray-500 text-lg font-medium">Select a forecast option to visualize price trends</p>
                <p class="text-gray-400 text-sm mt-2">Historical data + AI predictions in one chart</p>
            </div>
        </div>

        <!-- Premium Footer -->
        <div class="mt-10 text-center fade-in">
            <div class="glass-card rounded-2xl p-6 inline-block">
                <div class="flex items-center gap-3 justify-center mb-2">
                    <div class="w-2 h-2 rounded-full bg-green-500 pulse-dot"></div>
                    <span class="text-sm font-semibold text-gray-700">System Status</span>
                </div>
                <p id="modelInfo" class="text-xs text-gray-600 font-mono">Connecting to AI server...</p>
            </div>
            <p class="text-white/60 text-xs mt-4">Powered by Deep Learning ¬∑ Built with ‚ù§Ô∏è</p>
        </div>
    </div>

    <script>
        (function() {
            const API_BASE = 'http://127.0.0.1:5001';
            let chart = null;
            let availableModels = [];

            // Enhanced status display with colors
            function showStatus(type, message) {
                const bar = document.getElementById('statusBar');
                const msg = document.getElementById('statusMessage');
                if (!bar) return;
                
                bar.classList.remove('hidden', 'border-purple-500', 'border-green-500', 'border-yellow-500', 'border-red-500');
                
                const colorMap = {
                    success: 'border-green-500',
                    warning: 'border-yellow-500',
                    error: 'border-red-500',
                    info: 'border-purple-500'
                };
                
                bar.classList.add(colorMap[type] || 'border-purple-500');
                msg.textContent = message;
            }

            // Enhanced loading state
            function setLoading(btnId, isLoading, originalText) {
                const btn = document.getElementById(btnId);
                if (!btn) return;
                btn.disabled = isLoading;
                if (isLoading) {
                    btn.innerHTML = `<span class="inline-block animate-spin mr-2">‚öôÔ∏è</span>Processing...`;
                    btn.classList.add('opacity-75', 'cursor-wait');
                } else {
                    btn.innerHTML = originalText;
                    btn.classList.remove('opacity-75', 'cursor-wait');
                }
            }

            // Update date with premium styling
            function updateDate() {
                const el = document.getElementById('currentDate');
                if (el) {
                    const d = new Date();
                    el.textContent = 'üïê ' + d.toLocaleDateString('en-IN', { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    });
                }
            }

            // Health check
            async function checkHealth() {
                try {
                    const res = await fetch(`${API_BASE}/health`);
                    const data = await res.json();
                    if (data.status === 'healthy') {
                        showStatus('success', '‚úÖ Server is online and ready');
                    } else {
                        showStatus('warning', '‚ö†Ô∏è Server is responding but unstable');
                    }
                } catch (e) {
                    showStatus('error', '‚ùå Cannot connect to Flask server (Port 5001)');
                }
            }

            // Load available models
            async function loadModels() {
                try {
                    const res = await fetch(`${API_BASE}/models`);
                    const data = await res.json();
                    availableModels = data.models || [];
                    const seq = data.config?.sequence_length || 30;
                    const fcast = data.config?.forecast_days || 7;
                    
                    document.getElementById('modelInfo').innerHTML = 
                        `ü§ñ Models: <strong>${availableModels.join(' ¬∑ ') || 'None loaded'}</strong> | Sequence: ${seq}d | Forecast: ${fcast}d`;
                    
                    // Disable buttons if models not available
                    if (!availableModels.includes('adike')) {
                        ['predictAdike', 'forecastAdike'].forEach(id => {
                            const btn = document.getElementById(id);
                            if (btn) {
                                btn.disabled = true;
                                btn.classList.add('opacity-40', 'cursor-not-allowed');
                            }
                        });
                    }
                    if (!availableModels.includes('patora')) {
                        ['predictPatora', 'forecastPatora'].forEach(id => {
                            const btn = document.getElementById(id);
                            if (btn) {
                                btn.disabled = true;
                                btn.classList.add('opacity-40', 'cursor-not-allowed');
                            }
                        });
                    }
                } catch (e) {
                    document.getElementById('modelInfo').innerText = '‚ö†Ô∏è Model information unavailable';
                }
            }

            // Single day prediction
            window.predictPrice = async function(type) {
                const btnId = type === 'adike' ? 'predictAdike' : 'predictPatora';
                const displayName = type === 'adike' ? 'Adike' : 'Patora';
                const emoji = type === 'adike' ? 'ü••' : 'üå∞';
                const originalText = `<span class="text-xl mr-2">${emoji}</span> Predict ${displayName} Price`;
                
                setLoading(btnId, true, originalText);
                
                try {
                    const res = await fetch(`${API_BASE}/predict`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ type })
                    });
                    const result = await res.json();
                    
                    if (!res.ok) throw new Error(result.error || 'Prediction failed');
                    
                    const price = result.data.price;
                    const pricePerKg = (price / 100).toFixed(2);
                    const dateStr = result.data.date || 'Tomorrow';
                    
                    document.getElementById('predictionResult').classList.remove('hidden');
                    document.getElementById('predictionContent').innerHTML = `
                        <div class="space-y-3">
                            <div class="text-sm font-semibold text-gray-500">${displayName} ¬∑ ${dateStr}</div>
                            <div class="flex items-baseline justify-center gap-2">
                                <span class="text-5xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent price-glow">
                                    ‚Çπ${Number(price).toLocaleString('en-IN')}
                                </span>
                                <span class="text-lg text-gray-500">/quintal</span>
                            </div>
                            <div class="h-px w-24 mx-auto bg-gradient-to-r from-transparent via-purple-300 to-transparent"></div>
                            <div class="text-2xl font-semibold text-gray-700">
                                ‚Çπ${pricePerKg} <span class="text-sm text-gray-500">/kg</span>
                            </div>
                        </div>
                    `;
                    
                    showStatus('success', `‚úÖ ${displayName} prediction completed successfully`);
                } catch (err) {
                    showStatus('error', `‚ùå ${err.message}`);
                    document.getElementById('predictionResult').classList.add('hidden');
                } finally {
                    setLoading(btnId, false, originalText);
                }
            };

            // Multi-day forecast with chart
            window.generateForecast = async function(type) {
                const btnId = type === 'adike' ? 'forecastAdike' : 'forecastPatora';
                const displayName = type === 'adike' ? 'Adike' : 'Patora';
                const emoji = type === 'adike' ? 'üìâ' : 'üìà';
                const originalText = `<span class="text-xl mr-2">${emoji}</span> ${displayName} 7-Day Outlook`;
                
                setLoading(btnId, true, originalText);
                
                try {
                    const res = await fetch(`${API_BASE}/forecast`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ type })
                    });
                    const result = await res.json();
                    
                    if (!res.ok) throw new Error(result.error || 'Forecast failed');
                    
                    const data = result.data;
                    updateChart(data, displayName);
                    document.getElementById('chartTitle').innerHTML = 
                        `${displayName} Price Analysis <span class="text-lg text-gray-500">¬∑ Historical + Forecast</span>`;
                    showStatus('success', `‚úÖ ${displayName} 7-day forecast generated`);
                } catch (err) {
                    showStatus('error', `‚ùå ${err.message}`);
                } finally {
                    setLoading(btnId, false, originalText);
                }
            };

            // Enhanced chart with gradients
            function updateChart(data, title) {
                const ctx = document.getElementById('priceChart').getContext('2d');
                if (chart) chart.destroy();

                const labels = [...data.historical.dates, ...data.forecast.dates];
                const prices = [...data.historical.prices, ...data.forecast.prices];
                const historicalCount = data.historical.prices.length;

                // Create beautiful gradients
                const gradient = ctx.createLinearGradient(0, 0, 0, 400);
                gradient.addColorStop(0, 'rgba(102, 126, 234, 0.4)');
                gradient.addColorStop(0.5, 'rgba(118, 75, 162, 0.2)');
                gradient.addColorStop(1, 'rgba(102, 126, 234, 0.0)');

                chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: `${title} Price (‚Çπ/quintal)`,
                            data: prices,
                            borderColor: '#667eea',
                            backgroundColor: gradient,
                            borderWidth: 3,
                            pointRadius: 5,
                            pointHoverRadius: 8,
                            pointBackgroundColor: (ctx) => {
                                const index = ctx.dataIndex;
                                return index >= historicalCount ? '#f093fb' : '#667eea';
                            },
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            borderDash: (ctx) => {
                                const index = ctx.dataIndex;
                                return (index >= historicalCount) ? [8, 4] : [];
                            },
                            tension: 0.4,
                            fill: true,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            tooltip: {
                                backgroundColor: 'rgba(30, 30, 50, 0.95)',
                                titleColor: '#ffffff',
                                bodyColor: '#e0e7ff',
                                borderColor: '#667eea',
                                borderWidth: 2,
                                padding: 12,
                                displayColors: false,
                                callbacks: {
                                    label: (c) => `‚Çπ ${c.parsed.y.toLocaleString('en-IN')} per quintal`,
                                    title: (items) => {
                                        const idx = items[0].dataIndex;
                                        const type = idx < historicalCount ? 'üìä Historical' : 'üîÆ Forecast';
                                        return `${type} ¬∑ ${items[0].label}`;
                                    }
                                }
                            },
                            legend: {
                                display: true,
                                labels: {
                                    color: '#4b5563',
                                    font: { size: 13, weight: '600' },
                                    padding: 15
                                }
                            }
                        },
                        scales: {
                            y: {
                                grid: {
                                    color: 'rgba(156, 163, 175, 0.2)',
                                    drawBorder: false
                                },
                                ticks: {
                                    callback: (v) => '‚Çπ' + v.toLocaleString('en-IN'),
                                    color: '#6b7280',
                                    font: { size: 12, weight: '500' }
                                },
                                border: { display: false }
                            },
                            x: {
                                grid: {
                                    display: false,
                                    drawBorder: false
                                },
                                ticks: {
                                    color: '#6b7280',
                                    font: { size: 11, weight: '500' },
                                    maxRotation: 45
                                },
                                border: { display: false }
                            }
                        }
                    }
                });
                
                document.getElementById('chartMessage')?.classList.add('hidden');
            }

            // Initialize on page load
            document.addEventListener('DOMContentLoaded', async () => {
                updateDate();
                await checkHealth();
                await loadModels();
            });
        })();
    </script>
</body>
</html>